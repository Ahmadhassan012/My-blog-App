<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C++ Hidden Gems: Coroutines | My Tech Blog</title>
    <link rel="stylesheet" href="/My-blog-App/css/style.css">
    <link rel="stylesheet" href="/My-blog-App/css/custom.css">
  </head>
  <body>
    <header class="header">
      <div class="container">
        <a href="/My-blog-App/" class="logo">My Tech Blog</a>
        <div class="nav-wrapper">
          <nav class="nav" aria-label="Main navigation">
            <a href="/My-blog-App/">Home</a>
            <a href="/My-blog-App/blog/">Blog</a>
            <a href="/My-blog-App/changelog/">Changelog</a>
            <div class="dropdown">
              <button class="dropdown-btn" aria-haspopup="true" aria-expanded="false" aria-controls="categories-dropdown">Categories</button>
              <div class="dropdown-content" id="categories-dropdown">
                
                  <a href="/tags/ai/">AI</a>
                
                  <a href="/tags/api/">API</a>
                
                  <a href="/tags/apis/">APIs</a>
                
                  <a href="/tags/aws/">AWS</a>
                
                  <a href="/tags/agile/">Agile</a>
                
                  <a href="/tags/algorithms/">Algorithms</a>
                
                  <a href="/tags/ansible/">Ansible</a>
                
                  <a href="/tags/architecture/">Architecture</a>
                
                  <a href="/tags/automation/">Automation</a>
                
                  <a href="/tags/azure/">Azure</a>
                
                  <a href="/tags/best-practices/">Best Practices</a>
                
                  <a href="/tags/big-o/">Big O</a>
                
                  <a href="/tags/binary/">Binary</a>
                
                  <a href="/tags/c/">C++</a>
                
                  <a href="/tags/c20/">C++20</a>
                
                  <a href="/tags/cicd/">CI/CD</a>
                
                  <a href="/tags/cli/">CLI</a>
                
                  <a href="/tags/caching/">Caching</a>
                
                  <a href="/tags/clean-code/">Clean Code</a>
                
                  <a href="/tags/cloud-computing/">Cloud Computing</a>
                
                  <a href="/tags/cloud-native/">Cloud Native</a>
                
                  <a href="/tags/collaboration/">Collaboration</a>
                
                  <a href="/tags/compilers/">Compilers</a>
                
                  <a href="/tags/complexity-theory/">Complexity Theory</a>
                
                  <a href="/tags/computer-architecture/">Computer Architecture</a>
                
                  <a href="/tags/computer-networks/">Computer Networks</a>
                
                  <a href="/tags/computer-science/">Computer Science</a>
                
                  <a href="/tags/computer-vision/">Computer Vision</a>
                
                  <a href="/tags/concurrency/">Concurrency</a>
                
                  <a href="/tags/containers/">Containers</a>
                
                  <a href="/tags/cryptography/">Cryptography</a>
                
                  <a href="/tags/cybersecurity/">Cybersecurity</a>
                
                  <a href="/tags/data/">Data</a>
                
                  <a href="/tags/data-science/">Data Science</a>
                
                  <a href="/tags/data-structures/">Data Structures</a>
                
                  <a href="/tags/database/">Database</a>
                
                  <a href="/tags/databases/">Databases</a>
                
                  <a href="/tags/debugging/">Debugging</a>
                
                  <a href="/tags/deep-learning/">Deep Learning</a>
                
                  <a href="/tags/design-patterns/">Design Patterns</a>
                
                  <a href="/tags/devops/">DevOps</a>
                
                  <a href="/tags/development/">Development</a>
                
                  <a href="/tags/distributed-systems/">Distributed Systems</a>
                
                  <a href="/tags/docker/">Docker</a>
                
                  <a href="/tags/ethics/">Ethics</a>
                
                  <a href="/tags/federated-learning/">Federated Learning</a>
                
                  <a href="/tags/functional-programming/">Functional Programming</a>
                
                  <a href="/tags/future-tech/">Future Tech</a>
                
                  <a href="/tags/future-of-work/">Future of Work</a>
                
                  <a href="/tags/generative-ai/">Generative AI</a>
                
                  <a href="/tags/git/">Git</a>
                
                  <a href="/tags/grafana/">Grafana</a>
                
                  <a href="/tags/graphs/">Graphs</a>
                
                  <a href="/tags/hardware/">Hardware</a>
                
                  <a href="/tags/hashing/">Hashing</a>
                
                  <a href="/tags/iac/">IaC</a>
                
                  <a href="/tags/internet/">Internet</a>
                
                  <a href="/tags/interpreters/">Interpreters</a>
                
                  <a href="/tags/jamstack/">Jamstack</a>
                
                  <a href="/tags/javascript/">JavaScript</a>
                
                  <a href="/tags/kubernetes/">Kubernetes</a>
                
                  <a href="/tags/linux/">Linux</a>
                
                  <a href="/tags/machine-learning/">Machine Learning</a>
                
                  <a href="/tags/metaprogramming/">Metaprogramming</a>
                
                  <a href="/tags/microservices/">Microservices</a>
                
                  <a href="/tags/modern-c/">Modern C++</a>
                
                  <a href="/tags/monitoring/">Monitoring</a>
                
                  <a href="/tags/nlp/">NLP</a>
                
                  <a href="/tags/networking/">Networking</a>
                
                  <a href="/tags/neural-networks/">Neural Networks</a>
                
                  <a href="/tags/nginx/">Nginx</a>
                
                  <a href="/tags/nosql/">NoSQL</a>
                
                  <a href="/tags/oop/">OOP</a>
                
                  <a href="/tags/osi-model/">OSI Model</a>
                
                  <a href="/tags/operating-systems/">Operating Systems</a>
                
                  <a href="/tags/performance/">Performance</a>
                
                  <a href="/tags/postgresql/">PostgreSQL</a>
                
                  <a href="/tags/privacy/">Privacy</a>
                
                  <a href="/tags/productivity/">Productivity</a>
                
                  <a href="/tags/programming/">Programming</a>
                
                  <a href="/tags/programming-languages/">Programming Languages</a>
                
                  <a href="/tags/programming-paradigms/">Programming Paradigms</a>
                
                  <a href="/tags/project-management/">Project Management</a>
                
                  <a href="/tags/prometheus/">Prometheus</a>
                
                  <a href="/tags/python/">Python</a>
                
                  <a href="/tags/quality-assurance/">Quality Assurance</a>
                
                  <a href="/tags/quantum-computing/">Quantum Computing</a>
                
                  <a href="/tags/recursion/">Recursion</a>
                
                  <a href="/tags/redis/">Redis</a>
                
                  <a href="/tags/regex/">Regex</a>
                
                  <a href="/tags/reinforcement-learning/">Reinforcement Learning</a>
                
                  <a href="/tags/remote-work/">Remote Work</a>
                
                  <a href="/tags/reverse-proxy/">Reverse Proxy</a>
                
                  <a href="/tags/sql/">SQL</a>
                
                  <a href="/tags/security/">Security</a>
                
                  <a href="/tags/serverless/">Serverless</a>
                
                  <a href="/tags/software-architecture/">Software Architecture</a>
                
                  <a href="/tags/software-development/">Software Development</a>
                
                  <a href="/tags/software-engineering/">Software Engineering</a>
                
                  <a href="/tags/software-testing/">Software Testing</a>
                
                  <a href="/tags/sorting/">Sorting</a>
                
                  <a href="/tags/static-sites/">Static Sites</a>
                
                  <a href="/tags/systems/">Systems</a>
                
                  <a href="/tags/technology/">Technology</a>
                
                  <a href="/tags/terraform/">Terraform</a>
                
                  <a href="/tags/testing/">Testing</a>
                
                  <a href="/tags/text-processing/">Text Processing</a>
                
                  <a href="/tags/theory-of-computation/">Theory of Computation</a>
                
                  <a href="/tags/unsupervised-learning/">Unsupervised Learning</a>
                
                  <a href="/tags/vs-code/">VS Code</a>
                
                  <a href="/tags/version-control/">Version Control</a>
                
                  <a href="/tags/web/">Web</a>
                
                  <a href="/tags/web-development/">Web Development</a>
                
                  <a href="/tags/web-security/">Web Security</a>
                
                  <a href="/tags/web-server/">Web Server</a>
                
                  <a href="/tags/xai/">XAI</a>
                
              </div>
            </div>
            <a href="/My-blog-App/about/">About</a>
            <a href="/My-blog-App/contact/">Contact</a>
          </nav>
          <form action="/search" method="get" class="search-form">
            <input type="search" name="q" placeholder="Search..." aria-label="Search">
            <button type="submit">Search</button>
          </form>
          <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">ðŸŒ™</button>
        </div>
      </div>
    </header>

    <main class="main">
      <div class="container">
        
<article class="post">
  <header class="post-header">
    <h1 class="post-title">C++ Hidden Gems: Coroutines</h1>
    <div class="post-meta">
      <span>By Jules</span>
      <img src="/assets/images/author-jules.svg" alt="Photo of Jules" class="author-image" loading="lazy">
      <span> on <time datetime="2024-09-26">September 26, 2024</time></span>
    </div>
    
      <img src="/images/post-5-thumbnail.svg" alt="Thumbnail for C++ Hidden Gems: Coroutines" class="post-thumbnail" loading="lazy">
    
  </header>

  <div class="post-content">
    <p>Asynchronous programming is becoming increasingly important in modern software development, but it can be challenging to write and reason about. Traditional approaches like callbacks and futures can lead to complex and hard-to-read code.</p>
<p>C++20 introduced a powerful new feature that aims to simplify asynchronous programming: <strong>coroutines</strong>.</p>
<h2>What are Coroutines?</h2>
<p>A coroutine is a function that can be suspended and resumed. It allows you to write asynchronous code in a way that looks and feels like synchronous code. When a coroutine is suspended, it returns control to the caller, and its state is saved. It can then be resumed later from where it left off.</p>
<h2>The <code>co_await</code>, <code>co_yield</code>, and <code>co_return</code> Keywords</h2>
<p>C++20 introduces three new keywords for working with coroutines:</p>
<ul>
<li><strong><code>co_await</code>:</strong> This keyword suspends the coroutine and waits for an operation to complete. For example, you could <code>co_await</code> a network request.</li>
<li><strong><code>co_yield</code>:</strong> This keyword is used to produce a value from a coroutine, making it act like a generator.</li>
<li><strong><code>co_return</code>:</strong> This keyword is used to return a value from a coroutine.</li>
</ul>
<h2>Coroutines as Generators</h2>
<p>One of the simplest ways to understand coroutines is to see how they can be used to create generators. A generator is a function that can produce a sequence of values on demand.</p>
<p>Here's an example of a simple generator that produces a sequence of integers:</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;coroutine&gt;
#include &lt;ranges&gt;

// A simple generator type (requires a more complex implementation in practice)
struct generator {
    struct promise_type {
        int current_value;
        auto get_return_object() { return generator{handle_type::from_promise(*this)}; }
        auto initial_suspend() { return std::suspend_always{}; }
        auto final_suspend() noexcept { return std::suspend_always{}; }
        void unhandled_exception() {}
        void return_void() {}
        auto yield_value(int value) {
            current_value = value;
            return std::suspend_always{};
        }
    };
    using handle_type = std::coroutine_handle&lt;promise_type&gt;;
    handle_type coro;

    generator(handle_type h) : coro(h) {}
    ~generator() { if (coro) coro.destroy(); }
    int operator()() {
        coro.resume();
        return coro.promise().current_value;
    }
};

generator count_to(int n) {
    for (int i = 0; i &lt; n; ++i) {
        co_yield i;
    }
}

int main() {
    auto gen = count_to(5);
    for (int i = 0; i &lt; 5; ++i) {
        std::cout &lt;&lt; gen() &lt;&lt; &quot; &quot;; // Prints 0 1 2 3 4
    }
}
</code></pre>
<p><em>(Note: The implementation of a generator type is complex and beyond the scope of this post. The example above is a simplified illustration.)</em></p>
<p>The <code>count_to</code> function is a coroutine. Each time <code>co_yield</code> is called, the function is suspended, and a value is produced.</p>
<h2>Coroutines for Asynchronous Programming</h2>
<p>The primary motivation for coroutines is to simplify asynchronous programming. With coroutines, you can write asynchronous code that looks like this:</p>
<pre><code class="language-cpp">// This is a conceptual example. `async_read` would return an &quot;awaitable&quot; object.
task&lt;std::string&gt; read_file_async(const std::string&amp; filename) {
    auto file = co_await open_file_async(filename);
    auto buffer = co_await file.read_async();
    co_return buffer;
}
</code></pre>
<p>This code looks synchronous, but the <code>co_await</code> keywords indicate that the function may be suspended at these points. This makes the code much easier to read and reason about than a callback-based approach.</p>
<h2>The Coroutine Framework is a Library Feature</h2>
<p>One of the unique things about C++ coroutines is that they are designed as a language feature that is implemented by libraries. The meaning of <code>co_await</code>, <code>co_yield</code>, and <code>co_return</code> is determined by the return type of the coroutine. This makes the C++ coroutine framework incredibly flexible and powerful, but it also means that there is a bit of a learning curve.</p>
<p>To use coroutines, you will typically use a library that provides the necessary &quot;awaitable&quot; and &quot;promise&quot; types, such as <code>cppcoro</code> or the networking library Asio.</p>
<h2>Conclusion</h2>
<p>Coroutines are one of the most significant and complex features of C++20. They represent a fundamental shift in how we write concurrent and asynchronous code in C++. While the learning curve can be steep, the benefits in terms of code readability and maintainability are enormous.</p>
<p>Coroutines are a hidden gem that will unlock new possibilities for writing high-performance, asynchronous C++ code. As libraries provide better support for coroutines, they are likely to become the standard way to write asynchronous code in C++. It's a powerful feature that is shaping the future of the language. It's a new tool for a new era of programming.</p>

  </div>
</article>

      </div>
    </main>

    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="newsletter-signup">
            <h3>Subscribe to our Newsletter</h3>
            <p>Get the latest tech news and articles delivered to your inbox.</p>
            <form class="newsletter-form">
              <input type="email" placeholder="Enter your email" required>
              <button type="submit" class="button">Subscribe</button>
            </form>
          </div>
          <div class="footer-links">
            <a href="/My-blog-App/">Home</a>
            <a href="/My-blog-App/blog/">Blog</a>
            <a href="/My-blog-App/about/">About</a>
            <a href="/My-blog-App/contact/">Contact</a>
            <a href="/My-blog-App/privacy/">Privacy Policy</a>
            <a href="/My-blog-App/terms/">Terms of Service</a>
          </div>
        </div>
        <p class="copyright">&copy; 2024 My Tech Blog. All rights reserved.</p>
      </div>
    </footer>
    <script src="/My-blog-App/js/main.js"></script>
  </body>
</html>
